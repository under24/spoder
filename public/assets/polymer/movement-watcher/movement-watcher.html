<link rel="import" href="../../../../../bower_components/polymer/polymer-element.html">

<dom-module id="movement-watcher">
  <script>
    class movementWatcher extends ReduxMixin(Polymer.Element) {
      static get is() { return 'movement-watcher'; }
      static get properties() {
        return {
          legs: {
            statePath: 'legs'
          },
          direction: {
            statePath: 'movement.direction',
            observer: 'observeDirection'
          },
          circles: {
            statePath: 'movement.circles',
            observer: 'observeCircles'
          }
        }
      }
      
      observeDirection() {
        this.calcMovementPointersFrom();
      }
      
      observeCircles() {
        this.calcMovementPointersFrom();
      }
      
      calcMovementPointersFrom() {
        if (this.circles === undefined || this.direction === undefined) return;

        let payload = {};
        
        for (let legId = 1; legId <= 6; legId++) {
          payload[legId] = {};
          
          switch (this.legs[legId].side) {
            case 'left':
              payload[legId].x = this.circles[legId].centerX - this.circles[legId].radius * (this.direction.x / 100); break;
            case 'right':
              payload[legId].x = this.circles[legId].centerX + this.circles[legId].radius * (this.direction.x / 100); break;
          }
          payload[legId].y = this.circles[legId].centerY - this.circles[legId].radius * (this.direction.y / 100);
        }
        
        this.batchDispatch(payload);    
      }
      
      batchDispatch(payload) {
        store.dispatch({
          type: "MOVEMENT_POINTERS_CHANGED_BATCHED",
          payload
        });      
      }

    }
    window.customElements.define(movementWatcher.is, movementWatcher);
  </script>
</dom-module>