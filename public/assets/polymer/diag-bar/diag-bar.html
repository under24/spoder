<link rel="import" href="../../../../../bower_components/polymer/polymer-element.html">
<!--<link rel="import" href="../polymer/lib/elements/dom-if.html">-->
<!--<link rel="import" href="../polymer/lib/elements/dom-repeat.html">-->

<dom-module id="diag-bar">
  <template>
    <style>
      :host {
        display: inline-block;
        padding: 8px;
        margin: 0px 2px;
      }
      .bar-wrapper {
        height: 210px;
        position: relative;
      }
      .bar-wrapper #bar {
        width: 28px;
        height: 0px;
        display: inline-block;
        position: absolute;
        bottom: 0px;
        background: linear-gradient(135deg, rgb(96, 92, 238), rgb(117, 113, 200)) rgb(103, 102, 219);
      }
      .bar-wrapper #bar #barHandle {
        position: absolute;
        top: 0px;
        display: inline-block;
        height: 14px;
        left: -4px;
        right: -4px;
        background-image: linear-gradient(100deg,#FE8155 0,#F95462 35%,#ED7AA3 100%);
        transform: translateY(-50%);
        opacity: 0;
        transition: 0.2s ease-in-out all;
        border-radius: 20%;
      }
      :host(:hover) .bar-wrapper #bar #barHandle {
        opacity: 1;
      }
      .bar-wrapper #bar #barHandle:hover {
        left: -6px;
        right: -6px;
        height: 16px;
      }
      .bar-wrapper .info-block {
        font-size: 16px;
        overflow: hidden;
        width: 28px;
      }
    </style>
    <div class="bar-wrapper">
      <div id="bar">
        <div id="barHandle"></div>
      </div>
      <div class="info-block">[[value]]</div>
    </div>
  </template>

  <script>
    class diagBar extends Polymer.Element {
      static get is() { return 'diag-bar'; }
      static get properties() {
        return {
          min: {
            type: Number,
            value: 0
          },
          max: {
            type: Number,
            value: 180
          },
          value: {
            type: Number,
            value: 100,
            observer: 'valueObserver'
          }
        };
      }

      ready() {
        super.ready();
        // this.attachHandler();
        // if (this.value) this.setHeight(this.value);
      }
      
      valueObserver(newValue, oldValue) {
        this.setHeight(newValue);
      }
      
      setHeight(height) {
        if (height === undefined) return;
        if (height > this.max) return;
        if (height < this.min) return;
        
        this.$.bar.style.height = height + 'px';
        this.value = height;
      }
      
      attachHandler() {
        this.$.barHandle.onmousedown = (e) => {
          let clickY = e.clientY;
          let value = this.value;
          
          document.onmousemove = function(e) {
            let differentialY = clickY - e.clientY;
            this.setHeight(differentialY + value);
            
          }.bind(this);
          
          document.onmouseup = () => {
            document.onmouseup = null;
            document.onmousemove = null;
          }
        }
      }

    }

    window.customElements.define(diagBar.is, diagBar);
  </script>
</dom-module>