<link rel="import" href="../../../../../bower_components/polymer/polymer-element.html">

<dom-module id="modifier-watcher">
  <script>
    class modifierWatcher extends ReduxMixin(Polymer.Element) {
      static get is() { return 'modifier-watcher'; }
      static get properties() {
        return {
          levelModifier: {
            statePath: 'modifiers.level',
            observer: 'observeLevelModifier'
          },
          tiltModifier: {
            statePath: 'modifiers.tilt',
            observer: 'observeTiltModifier'
          },
          shiftModifier: {
            statePath: 'modifiers.shift',
            observer: 'observeShiftModifier'
          },
          rotationModifier: {
            statePath: 'modifiers.rotation',
            observer: 'observeRotationModifier'
          }
        };
      }
      
      observeLevelModifier(newValue, oldValue) {
        if (oldValue === undefined) return;
        if (newValue.levelModifier === oldValue.levelModifier) return;
        
        let payload = oldValue.levelModifier - newValue.levelModifier
        store.dispatch({ type: "BASE_Y_LEVEL_MODIFIER_CHANGE_RECALC_BASE_Y", payload });
      }
      
      observeTiltModifier(newValue, oldValue) {
        if (oldValue === undefined) return;
        if (newValue.backTiltModifier === oldValue.backTiltModifier &&
            newValue.frontTiltModifier === oldValue.frontTiltModifier &&
            newValue.leftTiltModifier === oldValue.leftTiltModifier &&
            newValue.rightTiltModifier === oldValue.rightTiltModifier
        ) return;
        
        let payload = {
          backTiltModifier: oldValue.backTiltModifier - newValue.backTiltModifier,
          frontTiltModifier: oldValue.frontTiltModifier - newValue.frontTiltModifier,
          leftTiltModifier: oldValue.leftTiltModifier - newValue.leftTiltModifier,
          rightTiltModifier: oldValue.rightTiltModifier - newValue.rightTiltModifier
        }
        store.dispatch({ type: "BASE_Y_TILT_MODIFIER_CHANGE_RECALC_BASE_Y", payload });
      }
      
      observeShiftModifier(newValue, oldValue) {
        if (oldValue === undefined) return;
        if (newValue.x === oldValue.x && newValue.y === oldValue.y) return;        

        let payload = {
          x: oldValue.x - newValue.x,
          y: oldValue.y - newValue.y
        }
        store.dispatch({ type: "BASE_XY_SHIFT_MODIFIER_CHANGE_RECALC_BASE_XY", payload });
      }
      
      observeRotationModifier(newValue, oldValue) {
        if (oldValue === undefined) return;
        if (newValue.rotationModifier === oldValue.rotationModifier) return;
        
        let payload = {
          rotation: oldValue.rotationModifier - newValue.rotationModifier
        }
        store.dispatch({ type: 'BASE_XY_ROTATION_MODIFIER_CHANGE', payload });
      }

    }

    window.customElements.define(modifierWatcher.is, modifierWatcher);
  </script>
</dom-module>
