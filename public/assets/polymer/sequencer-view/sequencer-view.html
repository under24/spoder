<link rel="import" href="../../../../../bower_components/polymer/polymer-element.html">

<dom-module id="sequencer-view">
  <template>
    <style>
      :host {
        display: block;
        width: 100%;
        height: 100%;
        position: relative;
      }
      #sequenceTimeline {
        width: 95%;
        border: 1px solid;
        margin: auto;
        box-sizing: border-box;
        position: relative;
        display: flex;
        flex-direction: column;
      }
      #sequenceTimeline .leg-sequence {
        font-size: 17px;
        display: flex;
      }
      #sequenceTimeline hr {
        margin: 0px;
        border-bottom: none;
        border-left: none;
        border-right: none;
      }
      #sequenceTimeline .sequence-header {
        display: inline-block;
        border-right: 1px solid;
        padding: 4px 0px 4px 8px;
        width: 50px;
      }
      #sequenceTimeline #cursor {
        width: 1px;
        background: black;
        position: absolute;
        display: inline-block;
        top: 0px;
        bottom: 0px;
      }
      #sequenceTimeline #cursor::after {
        content: '';
        display: inline-block;
        width: 10px;
        background-color: rgba(0, 0, 0, 0.05);
        top: 0px;
        bottom: 0px;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
      }
      #cursorKnob {
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(128, 128, 128, 0.21);
        padding: 4px 8px 2px;
      }
      .sequence-content {
        flex: 1;
        position: relative;
      }
      .sequence-content .payload {
        position: absolute;
        background-color: rgba(0, 0, 0, 0.2);
        top: 3px;
        bottom: 3px;
        text-align: center;
        line-height: 22px;
      }
      .cursor-wrapper {
        position: absolute;
        top: 0px;
        bottom: 0px;
        left: 59px;
        right: 0px;
      }
      fieldset {
        width: 95%;
        box-sizing: border-box;
        margin: 0px auto 10px auto;
        border-width: 1px;
      }
    </style>

    <br /><br /><br />
    
    <div id="sequenceTimeline">
      <div class="leg-sequence" id="leg1">
        <div class="sequence-header">L1 (1)</div>
        <div class="sequence-content">
          <div class="payload">25</div>
        </div>
      </div>
      <hr />
      <div class="leg-sequence" id="leg2">
        <div class="sequence-header">R1 (2)</div>
        <div class="sequence-content">
          <div class="payload">25</div>
        </div>
      </div>
      <hr />
      <div class="leg-sequence" id="leg3">
        <div class="sequence-header">L2 (3)</div>
        <div class="sequence-content">
          <div class="payload">25</div>
        </div>
      </div>
      <hr />
      <div class="leg-sequence" id="leg4">
        <div class="sequence-header">R2 (4)</div>
        <div class="sequence-content">
          <div class="payload">25</div>
        </div>
      </div>
      <hr />
      <div class="leg-sequence" id="leg5">
        <div class="sequence-header">L3 (5)</div>
        <div class="sequence-content">
          <div class="payload">25</div>
        </div>
      </div>
      <hr />
      <div class="leg-sequence" id="leg6">
        <div class="sequence-header">R3 (6)</div>
        <div class="sequence-content">
          <div class="payload">25</div>
        </div>
      </div>
      
      <div class="cursor-wrapper">
        <div id="cursor" style$="left: [[sequenceProgress]]%">
          <div id="cursorKnob">[[sequenceProgress]]</div>
        </div>
      </div>

    </div>
    
    <br /><br />
    <fieldset>
      <legend>Blueprint</legend>
      <button type="button" on-click="onGenerateBlueprintButtonClicked">Generate Blueprint</button>
      <button type="button">Load Blueprint UI</button>
    </fieldset>
    <fieldset>
      <legend>Sequence</legend>
      <button type="button" on-click="onGenerateSequenceButtonClicked">Generate Sequence</button>
    </fieldset>
    <fieldset>
      <legend>Player</legend>
      <button type="button" on-click="onPlaySequenceButtonClicked">Play</button>
      <button type="button" on-click="onAbortSequenceButtonClicked">Stop</button>
    </fieldset>
    
    
  </template>

  <script>
    class sequencerView extends ReduxMixin(Polymer.Element) {
      static get is() { return 'sequencer-view'; }
      static get properties() {
        return {
          pointers: {
            statePath: 'movement.pointers'
          },
          circles: {
            statePath: 'movement.circles'
          },
          coords: {
            statePath: 'coords'
          },
          gaits: {
            statePath: 'gaits'
          },
          sequenceProgress: {
            statePath: 'movement.sequenceProgress'
          }
        };
      }
      
      generateSequenceBlueprint() {
        let result = {};
        
        for (let i = 1; i <= 6; i++) {
          let pointerToCursorX = this.coords[i].transverseCursorX - this.pointers[i].x,
              pointerToCursorY = this.coords[i].transverseCursorY - this.pointers[i].y,

              pointerToCircleCenterX = this.circles[i].centerX - this.pointers[i].x,
              pointerToCircleCenterY = this.circles[i].centerY - this.pointers[i].y,

              pctInfo = this.getStartAndEndPctBasedOnLegId(i);

          result[i] = [
            {
              "coordType": "transverseBaseX",
              "startPct": 0,
              "endPct": 100,
              "pxlsToMove": pointerToCircleCenterX
            },
            {
              "coordType": "transverseBaseY",
              "startPct": 0,
              "endPct": 100,
              "pxlsToMove": pointerToCircleCenterY
            },
            {
              "coordType": "transverseCursorX",
              "startPct": pctInfo.startPct,
              "endPct": pctInfo.endPct,
              "pxlsToMove": pointerToCursorX
            },
            {
              "coordType": "transverseCursorY",
              "startPct": pctInfo.startPct,
              "endPct": pctInfo.endPct,
              "pxlsToMove": pointerToCursorY
            }
          ];
        }
        
        return result;
      }
      
      getStartAndEndPctBasedOnLegId(legId) {
        switch (legId) {
          case 1:
          case 6:
            return { startPct: 50, endPct: 75 };
          case 2:
          case 5:
            return { startPct: 0, endPct: 25 };
          case 3:
            return { startPct: 25, endPct: 50 };
          case 4:
            return { startPct: 75, endPct: 100 };
        }
      }
      
      loadData(blueprint, timeline, metaData) {
        
      }
      
      onGenerateBlueprintButtonClicked() {
        this.blueprint = this.generateSequenceBlueprint();
      }
      
      onGenerateSequenceButtonClicked() {
        this.sequence = SU.generateSequenceTimeline(this.blueprint, 60, 750);
      }
      
      onPlaySequenceButtonClicked() {
        SU.playSequence(this.sequence);
      }
      
      onAbortSequenceButtonClicked() {
        SU.abortSequnce = true;
      }

    }
    window.customElements.define(sequencerView.is, sequencerView);
  </script>
</dom-module>