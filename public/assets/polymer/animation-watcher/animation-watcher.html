<link rel="import" href="../../../../../bower_components/polymer/polymer-element.html">

<dom-module id="animation-watcher">
  <script>
    class animationWatcher extends ReduxMixin(Polymer.Element) {
      static get is() { return 'animation-watcher'; }
      static get properties() {
        return {
          legs: {
            statePath: 'legs'
          },
          animationPointers: {
            statePath: 'animation.pointers'
          },
          misc1: {
            statePath: 'misc.1.transverseAnimationCircle'
          },
          misc2: {
            statePath: 'misc.2.transverseAnimationCircle'
          },
          misc3: {
            statePath: 'misc.3.transverseAnimationCircle'
          },
          misc4: {
            statePath: 'misc.4.transverseAnimationCircle'
          },
          misc5: {
            statePath: 'misc.5.transverseAnimationCircle'
          },
          misc6: {
            statePath: 'misc.6.transverseAnimationCircle'
          },
          joystick: {
            statePath: 'animation.joystick'
          }
        };
      }
      
      static get observers() {
        return [
          'observeAnimationPointer(misc1, joystick)',
          'observeAnimationPointer(misc2, joystick)',
          'observeAnimationPointer(misc3, joystick)',
          'observeAnimationPointer(misc4, joystick)',
          'observeAnimationPointer(misc5, joystick)',
          'observeAnimationPointer(misc6, joystick)'
        ]
      }
      
      observeAnimationPointer(misc, joystick) {
        if (misc === undefined || joystick === undefined || this.legs === undefined) return;
        
        let x;
        switch (this.legs[misc.legId].side) {
          case 'left':
            x = misc.centerX - misc.radius * (joystick.x / 100); break;
          case 'right':
            x = misc.centerX + misc.radius * (joystick.x / 100); break;
        }
        let y = misc.centerY - misc.radius * (joystick.y / 100);
        
        if (this.animationPointers[misc.legId].x === x &&
            this.animationPointers[misc.legId].y === y) return;
        
        store.dispatch({
          type: "ANIMATION_POINTER_CHANGED",
          legId: misc.legId,
          payload: { x, y }
        });
      }

    }

    window.customElements.define(animationWatcher.is, animationWatcher);
  </script>
</dom-module>
