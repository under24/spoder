<link rel="import" href="../../../../../bower_components/polymer/polymer-element.html">

<dom-module id="movement-sequencer">
  <script>
    class movementSequencer extends ReduxMixin(Polymer.Element) {
      static get is() { return 'movement-sequencer'; }
      static get properties() {
        return {
          iterationBlueprint: {
            statePath: 'movement.iteration.blueprint',
            observer: 'observeIterationBlueprint'
          },
          iterationGait: {
            statePath: 'movement.iteration.gait'
          },
          gaits: {
            statePath: 'gaits'
          }
        }
      }
      
      // make a new blueprint every time iteration movement data changes
      observeIterationBlueprint(newValue, oldValue) {
        this.blueprint = this.generateBlueprint();
      }
      
      generateBlueprint() {
        let blueprint = {};
        
        for (let legId = 1; legId <= 6; legId++) {
          blueprint[legId] = this.fillInBlueprintData(this.gaits[this.iterationGait].legTimings[legId], this.iterationBlueprint[legId]);
        }
        
        return blueprint;
      }
      
      fillInBlueprintData(legTimings, movementData) {
        // TODO REFACTOR
        
        return [
          {
            "coordType": "transverseBaseX",
            "startPct": 0,
            "endPct": 100,
            "pxlsToMove": movementData.transverseBaseX
          },
          {
            "coordType": "transverseBaseY",
            "startPct": 0,
            "endPct": 100,
            "pxlsToMove": movementData.transverseBaseY
          },
          {
            "coordType": "transverseCursorX",
            "startPct": legTimings.startPct,
            "endPct": legTimings.endPct,
            "pxlsToMove": movementData.transverseCursorX
          },
          {
            "coordType": "transverseCursorY",
            "startPct": legTimings.startPct,
            "endPct": legTimings.endPct,
            "pxlsToMove": movementData.transverseCursorY
          },
          {
            coordType: "sagittalCursorY",
            startPct: legTimings.startPct,
            endPct: legTimings.startPct + ((legTimings.endPct - legTimings.startPct) / 2),
            pxlsToMove: 25
          },
          {
            coordType: "sagittalCursorY",
            startPct: legTimings.endPct - ((legTimings.endPct - legTimings.startPct) / 2),
            endPct: legTimings.endPct,
            pxlsToMove: -25
          }
        ];
      }

    }
    window.customElements.define(movementSequencer.is, movementSequencer);
  </script>
</dom-module>
