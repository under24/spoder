<dom-module id="modifier-watcher">
  <script>
    class modifierWatcher extends ReduxMixin(Polymer.Element) {
      static get is() { return 'modifier-watcher'; }
      static get properties() {
        return {
          // levelModifier: {
          //   statePath: 'modifiers.level',
          //   observer: 'observeLevelModifier'
          // },
          tiltModifier: {
            statePath: 'modifiers.tilt',
            observer: 'observeTiltModifier'
          },
          shiftModifier: {
            statePath: 'modifiers.shift',
            observer: 'observeShiftModifier'
          },
          // rotationModifier: {
          //   statePath: 'modifiers.rotation',
          //   observer: 'observeRotationModifier'
          // }
        };
      }
      
      // level
      // observeLevelModifier(newValue, oldValue) {
      //   // old values is undefined. cannot compare new and old values
      //   if (oldValue === undefined) return;
      //   
      //   if (newValue.normalizedY === oldValue.normalizedY) {
      //     console.warn('same level modifier values');
      //     return;
      //   }
      //   
      //   // create a payload object for dispatching
      //   var payload = oldValue.normalizedY - newValue.normalizedY;
      //   
      //   store.dispatch({ type: "APPLY_LEVEL_MODIFIER_TO_COORDS", payload });
      // }
      
      // tilt
      observeTiltModifier(newValue, oldValue) {
        // old values is undefined. cannot compare new and old values
        if (oldValue === undefined) return;

        if (newValue.normalizedX === oldValue.normalizedX && 
            newValue.normalizedY === oldValue.normalizedY) {
          console.warn('same tilt modifier values');
          return;
        }        
        
        var x = oldValue.normalizedX - newValue.normalizedX,
            y = oldValue.normalizedY - newValue.normalizedY;
        
        // create a payload object for dispatching
        var payload = {
          leftTiltModifier: x,
          frontTiltModifier: y,
          rightTiltModifier: MU.flipNumber(x),
          backTiltModifier: MU.flipNumber(y),
        };
        
        store.dispatch({ type: "APPLY_TILT_MODIFIER_TO_COORDS", payload });
      }
      
      // shift
      observeShiftModifier(newValue, oldValue) {
        // old values is undefined. cannot compare new and old values
        if (oldValue === undefined) return;
        
        if (newValue.normalizedX === oldValue.normalizedX && 
            newValue.normalizedY === oldValue.normalizedY) {
          console.warn('same shift modifier values');
          return;
        }  

        // create a payload object for dispatching
        var payload = {
          x: oldValue.normalizedX - newValue.normalizedX,
          y: oldValue.normalizedY - newValue.normalizedY
        };
        
        store.dispatch({ type: "APPLY_SHIFT_MODIFIER_TO_COORDS", payload });
      }
      
      // rotation
      // observeRotationModifier(newValue, oldValue) {
      //   // old values is undefined. cannot compare new and old values
      //   if (oldValue === undefined) return;
      // 
      //   if (newValue.normalizedX === oldValue.normalizedX) {
      //     console.warn('same rotation modifier value');
      //     return;
      //   }
      // 
      //   // create a payload object for dispatching
      //   var payload = { rotation: oldValue.normalizedX - newValue.normalizedX };
      // 
      //   store.dispatch({ type: 'APPLY_ROTATION_MODIFIER_TO_COORDS', payload });
      // }

    }
    window.customElements.define(modifierWatcher.is, modifierWatcher);
  </script>
</dom-module>