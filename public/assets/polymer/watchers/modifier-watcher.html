<dom-module id="modifier-watcher">
  <script>
    class modifierWatcher extends ReduxMixin(Polymer.Element) {
      static get is() { return 'modifier-watcher'; }
      static get properties() {
        return {
          levelModifier: {
            statePath: 'modifiers.level',
            observer: 'observeLevelModifier'
          },
          tiltModifier: {
            statePath: 'modifiers.tilt',
            observer: 'observeTiltModifier'
          },
          shiftModifier: {
            statePath: 'modifiers.shift',
            observer: 'observeShiftModifier'
          },
          rotationModifier: {
            statePath: 'modifiers.rotation',
            observer: 'observeRotationModifier'
          }
        };
      }
      
      // level
      observeLevelModifier(newValue, oldValue) {
        // old values is undefined. cannot compare new and old values
        if (oldValue === undefined) return;
        
        if (newValue.normalizedY === oldValue.normalizedY) {
          console.warn('same level modifier values');
          return;
        }
        
        // create a payload object for dispatching
        var payload = oldValue.normalizedY - newValue.normalizedY;
        
        store.dispatch({ type: "APPLY_LEVEL_MODIFIER_TO_COORDS", payload });
      }
      
      observeTiltModifier(newValue, oldValue) {
        if (oldValue === undefined) return;
        if (newValue.backTiltModifier === oldValue.backTiltModifier &&
            newValue.frontTiltModifier === oldValue.frontTiltModifier &&
            newValue.leftTiltModifier === oldValue.leftTiltModifier &&
            newValue.rightTiltModifier === oldValue.rightTiltModifier
        ) {
          console.warn('same tilt modifier values');
          return;
        }
        
        var payload = {
          backTiltModifier: oldValue.backTiltModifier - newValue.backTiltModifier,
          frontTiltModifier: oldValue.frontTiltModifier - newValue.frontTiltModifier,
          leftTiltModifier: oldValue.leftTiltModifier - newValue.leftTiltModifier,
          rightTiltModifier: oldValue.rightTiltModifier - newValue.rightTiltModifier
        }
        store.dispatch({ type: "APPLY_TILT_MODIFIER_TO_COORDS", payload });
      }
      
      observeShiftModifier(newValue, oldValue) {
        if (oldValue === undefined) return;
        if (newValue.x === oldValue.x && newValue.y === oldValue.y) {
          console.warn('same shift modifier values');
          return;
        }  

        var payload = {
          x: oldValue.x - newValue.x,
          y: oldValue.y - newValue.y
        }
        store.dispatch({ type: "APPLY_SHIFT_MODIFIER_TO_COORDS", payload });
      }
      
      // rotation
      observeRotationModifier(newValue, oldValue) {
        // old values is undefined. cannot compare new and old values
        if (oldValue === undefined) return;
        
        if (newValue.normalizedX === oldValue.normalizedX) {
          console.warn('same rotation modifier value');
          return;
        }
        
        // create a payload object for dispatching
        var payload = { rotation: oldValue.normalizedX - newValue.normalizedX };
        
        store.dispatch({ type: 'APPLY_ROTATION_MODIFIER_TO_COORDS', payload });
      }

    }
    window.customElements.define(modifierWatcher.is, modifierWatcher);
  </script>
</dom-module>