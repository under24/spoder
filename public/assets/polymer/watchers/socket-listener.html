<link rel="import" href="socket-listener/angle-converter.html">

<dom-module id="socket-listener">
  <template>
    <angle-converter id="angleConverter"></angle-converter>
  </template>
  <script>
    class socketListener extends ReduxMixin(Polymer.Element) {
      static get is() { return 'socket-listener'; }
      static get properties() {
        return {
          angles: {
            statePath: 'angles',
            // observer: 'observeAngles'
          }
        }
      }
      
      connectedCallback() {
        super.connectedCallback();
        
        // socket connected
        socket.on('connect', function() {
          store.dispatch({ type: "SOCKET_STATUS_CHANGED", payload: { connected: true } });
        });
        // socket disconnected
        socket.on('disconnect', function() {
          store.dispatch({ type: "SOCKET_STATUS_CHANGED", payload: { connected: false } });
        });
        
        // TODO
        socket.on('sync-servo-angles', function(angles) {
          
        });
        
        
        
        socket.on('right-analog-stick-moved', (data) => {
          
          store.dispatch({
            type: "MOVEMENT_DIRECTION_JOYSTICK_VALUES_CHANGED",
            payload: {
              x: data.x,
              y: data.y
            }
          });
          
        });
      }
      
      observeAngles(servoAngles) {
        
        var temp = this.$.angleConverter.processCoordsFromServoAngles(servoAngles);
        console.log(temp);
      }

    }
    window.customElements.define(socketListener.is, socketListener);
  </script>
</dom-module>